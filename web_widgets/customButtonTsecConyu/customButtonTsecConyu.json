{"designerVersion":"1.4.34","id":"customButtonTsecConyu","name":"ButtonTsecConyu","lastUpdate":1526824037983,"template":"<div class=\"text-{{ properties.alignment }}\">\n    <button\n        ng-class=\"'btn btn-' + properties.buttonStyle\"\n        ng-click=\"ctrl.action()\"\n        type=\"button\"\n        ng-disabled=\"properties.disabled || ctrl.busy\" ng-bind-html=\"properties.label | uiTranslate\"></button>\n   \n</div>\n\n<br>\n","icon":"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 50 20'><g><path fill='#CBD5E1' d='M47,15.2c0,0.7-1.7,1.8-1.7,1.8S4.8,17,3.7,17c-1.6,0-3.6-1.9-3.6-1.9s0.7,4.8,4,5c2.4,0.1,42.4,0,42.4,0 s3.5-0.2,3.5-3.6c0-1.3,0.1-11.5,0.1-12.4c-0.1-2-4-4-4-4L47,1.8C47,1.8,47,14.5,47,15.2z'/><path fill='#fff' d='M3.9,1h40.3C45.7,1,47,2.2,47,3.6v10.8c0,1.4-1.3,2.6-2.9,2.6H3.9C2.3,17,1,15.8,1,14.4V3.6 C1,2.2,2.3,1,3.9,1z M3,0C1.3,0,0,1.3,0,3v12c0,1.7,1.3,3,3,3h42c1.7,0,3-1.3,3-3V3c0-1.7-1.3-3-3-3H3z'/></g></svg>","controller":"function PbButtonCtrl($scope, $http, $location, $log, $window) {\r\n   \r\n    var vm = this;\r\n    \r\n    this.action = function action() {\r\n          var id;\r\n          vm.busy = true;\r\n          $scope.properties.bloquear = true;\r\n          $scope.hbValidator = false ; \t\t\r\n          $scope.properties.dataFromSuccess = {}; \r\n          $scope.properties.respuestas = [];\r\n          $scope.properties.errores = [];\r\n          $scope.properties.validadorHb= false ; \r\n          $scope.radicar = true ; \r\n  \r\n          try{\r\n                            /******************PERSONAS********************/\r\n            //personas 1 \r\n            \r\n            var personasHttp = getRequestResponse('GET', $scope.properties.uriPersonas, null);\r\n            personasHttp.success(function(data, status, headers, config) {\r\n                \r\n                \r\n                data.lastName1 =  data.data.lastName.split(\" \")[0];\r\n                data.lastName2 =  data.data.lastName.split(\" \")[1];\r\n                data.data.identityDocuments[0].documentNumber = data.data.identityDocuments[0].documentNumber.replace(/^0+/, '');\r\n                \r\n                $scope.properties.dataFromSuccess.personas1 = {\r\n                    \"status\": 200,\r\n                    \"data\": data\r\n                };\r\n                $scope.clientId = data.data.clientId // customerId\r\n                $scope.customerId = data.data.customerId // CEDULA \r\n                $scope.customerId = \"1\" + $scope.customerId.padStart(15, \"0\") + \"0\";\r\n\r\n\r\n                //personas2\r\n                var personas2Http = getRequestResponse('GET', $scope.properties.uriPerAddresses + $scope.clientId + \"/addresses\", null);\r\n                personas2Http.success(function(data, status, headers, config) {\r\n                    $scope.properties.dataFromSuccess.personas2 = {\r\n                        \"status\": 200,\r\n                        \"data\": data\r\n                    };\r\n                });\r\n\r\n                //personas3\r\n                var personas3Http = getRequestResponse('GET', $scope.properties.uriPerEconomic + $scope.customerId + \"/economic-data\", null);\r\n                personas3Http.success(function(data, status, headers, config) {\r\n                    $scope.properties.dataFromSuccess.personas3 = {\r\n                        \"status\": 200,\r\n                        \"data\": data\r\n                    };\r\n                });\r\n            });\r\n\r\n        }catch (err) {\r\n            vm.busy = false;\r\n            notifyParentFrame({\r\n                message: 'error',\r\n                status: status,\r\n                dataFromError: data\r\n            });\r\n        } finally {\r\n            vm.busy = false;\r\n            notifyParentFrame({\r\n                message: 'success',\r\n                status: status,\r\n                //dataFromSuccess: data\r\n            });\r\n            $scope.properties.bloquear = false;\r\n        }\t\r\n  \r\n      \r\n\r\n  \r\n    \r\n    function getRequestResponse(method, url,tsec,data) {\r\n      vm.busy = true;\r\n      var req = {\r\n        method: method,\r\n        url: url,\r\n        data: angular.copy($scope.properties.dataToSend),    \r\n        headers: {'tsec': tsec}\r\n      };\t\r\n      var response = $http(req);\t\r\n      return response;     \r\n    }\r\n  \r\n    function notifyParentFrame(additionalProperties) {\r\n      if ($window.parent !== $window.self) {\r\n        var dataToSend = angular.extend({}, $scope.properties, additionalProperties);\r\n        $window.parent.postMessage(JSON.stringify(dataToSend), '*');\r\n      }\r\n    }\r\n  \r\n    function getUserParam() {\r\n      var userId = getUrlParam('user');\r\n      if (userId) {\r\n        return { 'user': userId };\r\n      }\r\n      return {};\r\n    }\r\n\r\n\r\n    function getUrlParam(param) {\r\n      var paramValue = $location.absUrl().match('[//?&]' + param + '=([^&#]*)($|[&#])');\r\n      if (paramValue) {\r\n        return paramValue[1];\r\n      }\r\n      return '';\r\n    }\r\n  \r\n\r\n}\r\n}","description":"Trigger for an action in a page or form","custom":true,"order":10,"properties":[{"label":"Disabled","name":"disabled","type":"boolean","defaultValue":false,"bond":"expression"},{"label":"Label","name":"label","type":"text","defaultValue":"Submit","bond":"interpolation"},{"label":"Alignment","name":"alignment","type":"choice","defaultValue":"left","choiceValues":["left","center","right"],"bond":"constant"},{"label":"Style","name":"buttonStyle","type":"choice","defaultValue":"default","choiceValues":["default","primary","success","info","warning","danger","link"],"bond":"constant"},{"label":"Action","name":"action","type":"choice","defaultValue":"Submit task","choiceValues":[{"value":"Submit task","label":"Submit task","group":"Bonita BPM"},{"value":"Start process","label":"Start process","group":"Bonita BPM"},{"value":"POST","label":"POST","group":"HTTP request"},{"value":"PUT","label":"PUT","group":"HTTP request"},{"value":"PATCH","label":"PATCH","group":"HTTP request"},{"value":"GET","label":"GET","group":"HTTP request"},{"value":"DELETE","label":"DELETE","group":"HTTP request"},{"value":"Add to collection","label":"Add to collection","group":"Collection"},{"value":"Remove from collection","label":"Remove from collection","group":"Collection"},{"value":"Higiene Basica","label":"Higiene Basica","group":"trycore"}],"bond":"constant"},{"label":"Data sent on click","name":"dataToSend","help":"Can be used to fulfill a contract","showFor":"properties.action.value === 'PATCH' || properties.action.value === 'POST' || properties.action.value === 'PUT' || properties.action.value === 'Submit task' || properties.action.value ===  'Start process'","type":"text","bond":"expression"},{"label":"Successful response value","name":"dataFromSuccess","help":"Holds the response when the request is successful","showFor":"['POST','PATCH', 'PUT', 'GET', 'DELETE', 'Submit task', 'Start process','Higiene Basica'].indexOf(properties.action.value) > -1","type":"text","bond":"variable"},{"label":"Failed response value","name":"dataFromError","help":"Holds the response when the request has failed","showFor":"['POST','PATCH', 'PUT', 'GET', 'DELETE', 'Submit task', 'Start process'].indexOf(properties.action.value) > -1","type":"text","bond":"variable"},{"label":"Target URL on success","name":"targetUrlOnSuccess","help":"Next page to display, for applications. In the Portal, it is ignored as navigation is managed automatically","showFor":"['POST','PATCH', 'PUT', 'DELETE', 'Submit task', 'Start process'].indexOf(properties.action.value) > -1","type":"text","bond":"interpolation"},{"label":"URL personas","name":"uriPersonas","help":"URL ya construida para llamar el servicio de personas","showFor":"properties.action.value === 'Higiene Basica'","type":"text","bond":"expression"},{"label":"URL personas Addresses","name":"uriPerAddresses","help":"URL ya construida para llamar el servicio de personas Addresses","showFor":"properties.action.value === 'Higiene Basica'","type":"text","bond":"expression"},{"label":"URL personas datos economicos","name":"uriPerEconomic","help":"URL ya construida para llamar el servicio de  personas datos economicos","showFor":"properties.action.value === 'Higiene Basica'","type":"text","bond":"expression"},{"label":"errores","name":"errores","caption":"errores","help":"errores","showFor":"properties.action.value === 'Higiene Basica'","type":"text","bond":"variable"},{"label":"otherProperties","name":"otherProperties","help":"otherProperties","type":"text","bond":"variable"},{"label":"Respuestas","name":"respuestas","type":"text","bond":"variable"}],"assets":[{"id":"538d16d2-d502-498a-a40f-861b3f583377","name":"cnmcUtiles.js","type":"js","order":1,"external":false}],"requiredModules":["CNMCUtiles"],"type":"widget"}