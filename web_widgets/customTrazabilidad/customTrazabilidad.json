{"designerVersion":"1.2.19","id":"customTrazabilidad","name":"Trazabilidad","lastUpdate":1525105958071,"template":"\n<div class=\"item-list\">\n    <div ng-repeat=\"item in properties.jsonArray\" class=\"item\" ng-class=\"{'expanded': item.expanded}\">\n        <div class=\"head\" ng-click=\"item.expanded = !item.expanded\">\n            <span class=\"date\" ng-if=\"properties.dateKey\">{{item[properties.dateKey]}}</span>\n            <span class=\"date\" ng-if=\"properties.dateKey && properties.titleKey\"> - </span>\n            <span class=\"title\" ng-if=\"properties.titleKey\">{{item[properties.titleKey]}}</span>\n            <span class=\"date\" ng-if=\"properties.titleKey && properties.subtitleKey\">&nbsp;</span>\n            <span class=\"subtitle\" ng-if=\"properties.subtitleKey\">{{item[properties.subtitleKey]}}</span>\n        </div>\n        \n        <div class=\"body\" ng-if=\"item.expanded\">\n            <div class=\"row\" ng-bind-html=\"htmlObjectAttributes(properties.dataKey ? item[properties.dataKey] : item)\"></div>\n            \n            <div class=\"row\" ng-repeat=\"link in itemLinks(properties.dataKey ? item[properties.dataKey] : item)\">\n                <div class=\"col-lg-12\">\n                    <div class=\"panel panel-default\">\n                        <div class=\"panel-heading\" style=\"cursor: pointer;\" ng-click=\"toggleLink(link)\">{{capitalize(link.rel)}}</div>\n                        <div class=\"panel-body\" ng-if=\"link.expanded\" ng-bind-html=\"link.htmlContent\"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>","controller":"\r\nfunction ($scope, $sce, $http) {\r\n    \r\n    $scope.itemLinks = function(item) {\r\n        if(item && item.links) {\r\n            var links = new Array();\r\n            \r\n            for(var i = 0; i < item.links.length; i++) {\r\n                links.push(item.links[i]);\r\n            }\r\n            \r\n            return links;\r\n        }\r\n        \r\n        return null;\r\n    }\r\n    \r\n    $scope.toggleLink = function(link) {\r\n        \r\n        if(!link.htmlContent) {\r\n            link.htmlContent = \"Cargando...\";\r\n            \r\n            $http.get($scope.properties.dbaccessURL + link.href).then(function(response) {\r\n                if(response.data) {\r\n                    var html = '';\r\n                    \r\n                    if(response.data instanceof Array) {\r\n                        for(var i = 0; i < response.data.length; i++) {\r\n                            html += '<div class=\"col-lg-12\">' +\r\n                                    '<div class=\"panel panel-default\">' +\r\n                                    '<div class=\"panel-body\">' +\r\n                                    $scope.htmlObjectAttributes(response.data[i]) +\r\n                                    '</div>' +\r\n                                    '</div>' +\r\n                                    '</div>';\r\n                        }    \r\n                    } else if(response.data instanceof Object) {\r\n                        html += $scope.htmlObjectAttributes(response.data);\r\n                    }\r\n                    \r\n                    link.htmlContent = $sce.trustAsHtml(html);\r\n                } else {\r\n                    link.htmlContent = null;\r\n                    alert(\"Error recuperando el link \" + $scope.capitalize(link.rel));f\r\n                }\r\n            }, function(error) {\r\n                link.htmlContent = null;\r\n                alert(\"Error recuperando el link \" + $scope.capitalize(link.rel));\r\n            });\r\n        } \r\n        \r\n        link.expanded = !link.expanded;\r\n    }\r\n    \r\n    $scope.htmlObjectAttributes = function(obj) {\r\n        \r\n        if(obj) {\r\n            var html = \"\";\r\n            \r\n            var objKeys = Object.keys(obj);\r\n            \r\n            for(var i = 0 ; i < objKeys.length; i++) {\r\n                if(objKeys[i] != '$$hashKey' && objKeys[i] != 'expanded' && objKeys[i] != 'links') {\r\n                    var htmlAttr = $scope.htmlAttribute(objKeys[i], obj[objKeys[i]]);\r\n                    \r\n                    if(htmlAttr && htmlAttr.length > 0) {\r\n                        html += htmlAttr;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            return $sce.trustAsHtml(html);\r\n        }\r\n    }\r\n    \r\n    $scope.htmlAttribute = function(label, value) {\r\n\t\tif(!$scope.isAttributeToHide(label)) {\r\n\t\t\tif(!(value instanceof Object) && !(value instanceof Array)) {\t\t\t\t\t\t\r\n\t\t\t\treturn $scope.htmlInput(label, value);\t\t\t\r\n\t\t\t} else if(value instanceof Array) {\r\n\t\t\t\treturn $scope.htmlArray(label, value);\r\n\t\t\t} else if(value instanceof Object) {\r\n\t\t\t\treturn $scope.htmlObject(label, value);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn \"\";\r\n\t\t}\t\t\r\n    }\r\n    \r\n    $scope.htmlInput = function(label, value) { \r\n\r\n\r\n\t\tif( $scope.capitalize(label) == \"Observacion\" || $scope.capitalize(label) == \"Observaciones\")\r\n\t\t{\r\n\t\t\tvar html = '<div class=\"col-lg-12 col-md-12\">' +\r\n\t\t\t\t   '<div class=\"form-group\">' +\r\n\t\t\t\t   '<label class=\"control-label\">' + $scope.capitalize(label) + '</label>' +\r\n\t\t\t\t   '<div>' +\r\n\t\t\t\t   '<textarea  rows=\"4\" cols=\"50\" class=\"form-control\" readonly >' + value + '</textarea>' +\r\n\t\t\t\t   '</div>' +\r\n\t\t\t\t   '</div>' +\r\n\t\t\t\t   '</div>';\r\n\t\t\t\t   \r\n\t\t\treturn html;     \r\n\t\t}\r\n\t\telse{\r\n\t\t\t\r\n\t\t\tvar html = '<div class=\"col-lg-6 col-md-12\">' +\r\n\t\t\t\t   '<div class=\"form-group\">' +\r\n\t\t\t\t   '<label class=\"control-label\">' + $scope.capitalize(label) + '</label>' +\r\n\t\t\t\t   '<div>' +\r\n\t\t\t\t   '<input type=\"text\" class=\"form-control\" readonly value=\"' + value + '\"/>' +\r\n\t\t\t\t   '</div>' +\r\n\t\t\t\t   '</div>' +\r\n\t\t\t\t   '</div>';\r\n\t\t\t\t   \r\n\t\t\treturn html;  \r\n\t\t\t\r\n\t\t}\r\n\t\t      \r\n    }\r\n    \r\n    $scope.htmlObject = function(label, value) {\r\n\t\t\r\n\t\tvalue = $scope.cleanHtmlObject(value);\r\n\t\t\r\n\t\tvar objKeys = Object.keys(value);\r\n\t\t\r\n\t\tif(objKeys.length == 1) {\r\n\t\t\treturn $scope.htmlAttribute(label, value[objKeys[0]]);\r\n\t\t} else if(objKeys.length > 1) {\r\n\t\t\tvar html = '<div class=\"col-md-12\">' +\r\n\t\t\t\t\t   '<div class=\"panel panel-default\">' +\r\n\t\t\t\t\t   (label ? '<div class=\"panel-heading\">' + $scope.capitalize(label) + '</div>' : '') +\r\n\t\t\t\t\t   '<div class=\"panel-body\">';\r\n\t\t\t\r\n\t\t\tfor(var i = 0; i < objKeys.length; i++) {\r\n\t\t\t\thtml += $scope.htmlAttribute(objKeys[i], value[objKeys[i]]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\thtml += '</div></div></div>';\r\n\t\t\t\r\n\t\t\treturn html;\r\n\t\t}\r\n\t\t\r\n\t\treturn \"\";\r\n    }\r\n\t\r\n\t$scope.cleanHtmlObject = function(value) {\r\n\t\t\r\n\t\tvar retValue = {};\r\n\t\t\r\n\t\tvar objKeys = Object.keys(value);\r\n\t\t\r\n\t\tfor(var i = 0; i < objKeys.length; i++) {\r\n\t\t\tif(!$scope.isAttributeToHide(objKeys[i])) {\r\n\t\t\t\tretValue[objKeys[i]] = value[objKeys[i]];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn retValue;\r\n\t}\r\n    \r\n    $scope.htmlArray = function(label, value) {\r\n        var html = '';\r\n        \r\n        if(value && value.length > 0) {\r\n            if($scope.isSimpleArray(value)) {\r\n                html += '<div class=\"form-group\">' +\r\n                        '<label class=\"control-label\">' + $scope.capitalize(label) + '</label>' +\r\n                        '<div>' +\r\n                        '<select class=\"form-control\" readonly/>';\r\n                        \r\n                for(var i = 0; i < value.length; i++) {\r\n                    html += '<option>' + value[i] + '</option>';\r\n                }\r\n                        \r\n                html += '</select>' +\r\n                        '</div>' +\r\n                        '</div>';\r\n            }  else {\r\n                html += '<div class=\"col-md-12\">' +\r\n                        '<div class=\"panel panel-default\">' +\r\n                        (label ? '<div class=\"panel-heading\">' + $scope.capitalize(label) + '</div>' : '') +\r\n                        '<div class=\"panel-body\">';\r\n                   \r\n                for(var i = 0; i < value.length; i++) {\r\n                    html += $scope.htmlAttribute(null, value[i]);\r\n                }\r\n                \r\n                html += '</div></div></div>';\r\n            }\r\n        }\r\n        \r\n        return html;\r\n    }\r\n    \r\n    $scope.isSimpleArray = function(value) {\r\n        if(value && value.length) {\r\n            for(var i = 0; i < value.length; i++) {\r\n                if(value[i] instanceof Object || value[i] instanceof Array) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    \r\n    $scope.capitalize = function(str) {\r\n        var capitalized = '';\r\n        \r\n        if(str) {\r\n            for(var i = 0; i < str.length; i++) {\r\n                if(i === 0) {\r\n                    capitalized = str[i].toUpperCase();\r\n                } else {\r\n                    if(str[i] == str[i].toUpperCase()) {\r\n                        capitalized += \" \";\r\n                    } \r\n                    \r\n                    capitalized += str[i].toLowerCase();\r\n                }\r\n            }\r\n        }\r\n        \r\n        return capitalized;\r\n    }\r\n    \r\n    $scope.isAttributeToHide = function(label) {\r\n        if(label && $scope.properties.attributesToHide) {\r\n            for(var i = 0; i < $scope.properties.attributesToHide.length; i++) {\r\n                if(label == $scope.properties.attributesToHide[i]) {\r\n                    return true;\r\n                }           \r\n            }\r\n        }\r\n        \r\n        return false;\r\n    }\r\n}","custom":true,"properties":[{"label":"Lista JSON","name":"jsonArray","type":"collection","bond":"expression"},{"label":"Clave atributo título","name":"titleKey","type":"text","bond":"expression"},{"label":"Clave atributo subtítulo","name":"subtitleKey","type":"text","bond":"expression"},{"label":"Clave atributo fecha","name":"dateKey","type":"text","bond":"expression"},{"label":"Clave atributo data","name":"dataKey","type":"text","bond":"expression"},{"label":"URL servicio BD","name":"dbaccessURL","type":"text","bond":"expression"},{"label":"Atributos a ocultar (Separar por comas)","name":"attributesToHide","type":"collection","bond":"expression"}],"assets":[{"id":"aa374e14-89db-4ab9-b79e-bfb992c29de1","name":"trazabilidad-styles.css","type":"css","order":11,"external":false}],"type":"widget"}